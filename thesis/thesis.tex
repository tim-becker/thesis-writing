\documentclass[12pt, letterpaper]{article}

\usepackage[margin=1.25in]{geometry}
\usepackage[margin=0.5in]{caption}

\usepackage{aliascnt}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage[backend=bibtex]{biblatex}
\usepackage[noabbrev,capitalize,nameinlink]{cleveref}
\usepackage{graphicx}
\usepackage{mathtools}
\usepackage{microtype}
\usepackage{tikz}

\usetikzlibrary{arrows,arrows.meta,automata,calc, positioning}

\newcommand{\paren}[1]{\left(#1\right)}
\newcommand{\pfrac}[2]{\paren{\frac{#1}{#2}}}

\newcommand{\Z}{\mathbb Z}
\newcommand{\N}{\mathbb N}
\newcommand{\Q}{\mathbb Q}
\newcommand{\C}{\mathbb C}
\newcommand{\bin}{\mathbf 2}
\newcommand{\A}{\mathcal A}
\newcommand{\CC}{\mathsf{CC}}
\newcommand{\ch}[1]{\mathbf{#1}}
\newcommand{\res}[2]{{{#1}_{\ch{#2}}}}
\newcommand{\I}{\mathcal I}
\renewcommand{\S}{\mathcal S}
\newcommand{\comp}{\mathfrak C}
\newcommand{\princ}{\mathfrak A}
\newcommand{\Aut}{\mathbf{Aut}}
\newcommand{\sg}{\mathcal S}
\newcommand{\gp}{\mathcal G}
\newcommand{\set}[1]{\left\{#1\right\}}
\newcommand{\R}{\mathbf R}
\newcommand{\f}[1]{\overline{#1}}
\newcommand{\ideal}{\mathfrak{I}}
\newcommand{\disc}[1]{\text{Disc}\paren{#1}}
\newcommand{\orb}{\mathbf{orb}}
\newcommand{\rk}[1]{\left|#1\right|}

\newcommand{\codeurl}{\texttt{https://github.com/tim-becker/thesis-code}}

\bibliography{thesis}

\newtheorem{thm}{Theorem}[section]
\newtheorem{lemma}[thm]{Lemma}
\newtheorem{cor}[thm]{Corollary}
\newtheorem{defn}[thm]{Definition}
\newtheorem{prop}[thm]{Proposition}
\newtheorem{conj}[thm]{Conjecture}
\newtheorem{example}[thm]{Example}
\crefname{thm}{Theorem}{Theorems}
\crefname{lemma}{Lemma}{Lemmas}
\crefname{cor}{Corollary}{Corollaries}
\crefname{defn}{Definition}{Definitions}
\crefname{conj}{Conjecture}{Conjectures}
\crefname{prop}{Proposition}{Propositions}
\crefname{example}{Example}{Examples}

\tikzset{%
        ->,
        auto,
        shorten > = 2pt,
        node distance=2.5cm
}
\tikzstyle{every state}=[
    draw = black,
    style = thick,
    fill = white,
    line width = 1pt,
    minimum size = 5mm
]
\tikzstyle{every edge}=[
    style = thick,
    draw = black,
    line width=1pt,
]


\begin{document}

\thispagestyle{empty}
\vspace*{\fill}
\begin{center}
    {\Huge Representations and Complexity of Abelian Automaton Groups}
    \vspace{1in}

    {\Large Tim Becker\hfill\\}
    \texttt{tjbecker@cmu.edu}

    \vspace{1in}

    {\large Advised by}\\
    {\Large Klaus Sutner\hfill\\}
    \texttt{sutner@cs.cmu.edu}
\end{center}
\vspace*{\fill}

\pagebreak
\thispagestyle{empty}

\abstract{
    Automaton groups are a class of groups generated by invertible finite-state
    transducers. We study representations of abelian automaton groups and their
    applications to the complexity of computational problems arising within
    these groups. We demonstrate a correspondence between abelian automaton
    groups and a class of ideals of a corresponding algebraic number field.
    Properties of this number field are utilized to construct efficient
    algorithms for problems related to orbits of finite state transductions.
    The algorithms developed within are implemented in the Sage computer
    algebra system and are publicly available.
}

\pagebreak
\thispagestyle{empty}

\tableofcontents

\pagebreak
\setcounter{page}{1}

\section{Introduction}
An \emph{invertible binary transducer} $\A$ is a Mealy automaton over the
binary alphabet where each state has an invertible output function. The
transductions of $\A$ are therefore length-preserving invertible functions on
binary strings. These transductions (along with their inverses) naturally
generate a group under composition, denoted $\gp(\A)$. Such groups, over a
general alphabet, are called automaton groups or self-similar groups; these
groups have been studied in great detail, see \cite{nekrashevych2014self,
    grigorchuk2000automata} for extensive studies.

Automaton groups have many interesting properties and are capable of surprising
complexity. A number of well-known groups can be generated by fairly simple
transducers, indicating that transducers may be a useful semantic
interpretation for many groups. Bartholdi's recent book review the Bulletin of
the AMS about the relationship between syntactic and semantic approaches
to algebra gives some examples where transducers play such a role
\cite{Bartholdi17:syntax_semantic_review}.  For instance, after Grigorchuk
famously solved the long-open problem of finding a group of intermediate
growth, it was realized that his group can be generated by the 5-state,
1-toggle invertible binary transducer shown in \cref{fig:grigorchuk}.  In fact,
even 3-state invertible binary transducers generate groups which are
exceedingly complicated, see \cite{2008arXiv0803.3555B} for a classification of
all such automata.
\begin{figure}[h]
    \centering
    \begin{tikzpicture}[node distance=3cm]
        \node[state] (1) {$q_1$};
        \node[state] (2) [above of=1] {$q_2$};
        \node[state] (3) [right of=2] {$q_3$};
        \node[state] (4) at ($(1)!0.5!(3)$) {$q_4$};
        \node[state] (5) [right of=1] {$q_5$};
      \path
      (1)
      edge node{\small $1/0$} node[swap]{\small $0/1$} (5)
      (2)
      edge node[left]{\small $0/0$} (1)
      edge node[right]{\small $1/1$} (4)
      (4)
      edge node[above=0.15]{\small $0/0$} (1)
      edge node[below=0.15]{\small $1/1$} (3)
      (3)
      edge node[above]{\small $1/1$}  (2)
      edge node[right]{\small $0/0$}  (5)
      (5)
      edge[loop right=45] node{\small $\substack{0/0\\1/1}$} (5)
      ;
    \end{tikzpicture}
    \caption{An invertible binary transducer generating Grigorchuk's group}
    \label{fig:grigorchuk}
\end{figure}

Here, we will be primarily concerned with a simpler class of transducers: those
which generate abelian groups. This situation has been previously studied in
\cite{Okano-Thesis, Sutner18:abelian_automata}. It is known that all abelian
automaton groups are either boolean or free abelian \cite{Okano-Thesis}, and in
the free abelian case, one can show that the underlying automata have nice
structural properties. We will summarize and build upon these results in
\cref{sec:abelian-automata}.  A running example in this thesis will be the
transducer $\CC^3_2$, shown in \cref{fig:cc-3-2}. This transducer generates a
group isomorphic to $\Z^2$ and is perhaps the simplest nontrivial transducer
generating an abelian group.


We will make connections between abelian automaton groups and other areas of
algebra that will provide useful insight into their structure and complexity.
A result of Nekrashevych and Sidki shows that the groups admit representations
where transitions in the transducer correspond to affine maps on $\Z^m$
\cite{nekrashevych2004automorphisms}.  In this thesis, we describe a related
representation of abelian automaton groups as fractional ideals of an
associated algebraic number field and describe how these may be efficiently
computed.

Properties of this representation can be used to study computational problems
arising in automaton groups. Given a transduction $f \in \gp(\A)$, we write
$f^* \subseteq \bin^* \times \bin^*$ for the binary relation obtained by
iterating $f$. Note that $f^*$ is a length-preserving equivalence relation on
$\bin^*$.  The complexity of this relation was first studied in
\cite{jalc170214}, where it was shown that for a certain class of abelian
transductions $f$, $f^*$ is rational. We will refer to such transductions as
\emph{orbit-rational}. For instance, it was shown in \cite{jalc170214} that
$\CC^3_2$ is orbit-rational.  In this thesis, we answer a more general question
by giving a precise characterization of orbit-rational abelian transducers and
a corresponding decision procedure.

The algorithms developed in this thesis are implemented in the Sage computer
algebra system and are available online at
\[
    \codeurl.
\]

Throughout this thesis, we will utilize the theory of free abelian groups,
linear algebra, field theory, and some algebraic number theory. See
\cite{Hungerford78} for the necessary material on the latter subjects, and
\cite{ireland1990classical, stein2012algebraic} for background on algebraic
number theory.
\begin{figure}
    \centering
    \begin{tikzpicture}
        \node[state] (1) {$q_1$};
        \node[state] (2) [below left of = 1] {$q_2$};
        \node[state] (3) [below right of = 1] {$q_3$};
        \path
        (1) edge[bend left, right]
        node {\small $1/0$} (2)
        (1) edge[bend left, right]
        node {\small $0/1$} (3)
        (2) edge[bend left, left]
        node {\small $a/a$} (1)
        (3) edge[bend left]
        node {\small $a/a$} (2)
        ;
    \end{tikzpicture}
    \caption{The cycle-cum-chord transducer $\CC^3_2$}
    \label{fig:cc-3-2}
\end{figure}

\pagebreak
\section{Background}
\subsection{Automata and Automaton Groups}
A \emph{binary transducer} is a Mealy automaton of the form $\A = \langle Q,
\bin, \delta, \lambda \rangle$ where $Q$ is a finite state set, $\delta: Q
\times \bin \rightarrow Q$ is the transition function, and $\lambda: Q \times
\bin \rightarrow \bin$ is the output function. Such a machine is
\emph{invertible} if for each state $q \in Q$, the output function $\lambda(q,
\cdot)$ is a permutation of $\bin$. A state $q$ is called a \emph{toggle} state
if $\lambda(q, \cdot)$ is the transposition and a \emph{copy} state otherwise.
We define the transduction of $q$, $\underline{q}: \bin^* \rightarrow \bin^*$
recursively as follows: $\underline{q}(\epsilon) = \epsilon$ and
$\underline{q}(a \cdot w) = \lambda(q, a) \cdot \underline{\delta(q, a)}(w)$,
where $\epsilon$ denotes the empty string, $\cdot$ denotes concatenation, and
$a \in \bin$. Note that invertibility of transductions follows from
invertibility of the transition functions.  The inverse machine $\A^{-1}$ is
computed by simply flipping the edge labels of $\A$: if
$p \xrightarrow{\ch{a} / \ch{b}} q$ in $\A$ then
$p^{-1} \xrightarrow{\ch{b} / \ch{a}} q^{-1}$ in $\A^{-1}$.

Invertible transducers define a subclass of automaton groups. The group
$\gp(\A)$ is formed by taking all transductions and their inverses under
composition.  As described in \cite{jalc170214} the group $\gp(\A)$ can be seen
as a subgroup of the automorphism group of the infinite binary tree, denoted
$\Aut(\bin^*)$.  Clearly any automorphism $f \in \Aut(\bin^*)$ can be written
in the form $f = (\res{f}{0}, \res{f}{1})\pi$ where $\pi \in S_2$. Here $\pi$
describes the action of $f$ on the root, and $\res{f}{0}$ and $\res{f}{1}$ are
the automorphisms induced by $f$ on the two subtrees. We call $(\res{f}{0},
\res{f}{1})\pi$ the \emph{wreath representation} of $f$; this name is derived
from the fact that $\Aut(\bin^*) \cong \Aut(\bin^*) \, \wr \, S_2$, where $\wr$
denotes the wreath product. Let $\sigma \in S_2$ denote the transposition. A
transduction $f$ is called \emph{odd} if $f = (\res{f}{0}, \res{f}{1}) \sigma$
and \emph{even} otherwise. In the even case, we'll write $f = (\res{f}{0},
\res{f}{1})$. We call the maps $f \mapsto \res{f}{a}$ for $\ch{a} \in \bin$ the
\emph{residuation maps}. Residuals can be extended to arbitrary length words by
$\res{f}{\epsilon} = f$ and $\res{f}{w \cdot a} = \res{(\res{f}{w})}{a}$, where
$w \in \bin^*$ and $a \in \bin$. The complete group automaton for $\A$, denoted
$\comp(\A)$, has as its state set $\gp(\A)$ with transitions of the form $f
\xrightarrow{\ch{a} / \ch{b}} \res{f}{a}$, where $\ch{b} = f \ch{a}$.

\subsection{Abelian Automata} \label{sec:abelian-automata}
For any automorphism $f \in \gp(\A)$, define its gap to be $\gamma_f =
(\res{f}{0})(\res{f}{1})^{-1}$, so that $\res{f}{0} = \gamma_f \res{f}{1}$. An
easy induction on the wreath product shows the following \cite{Okano-Thesis}:
\begin{lemma}\label{lemma:gap}
    An automaton group $\gp(\A)$ is abelian if, and only if, all even elements
    of G have gap value $I$, where $I$ denotes the identity automorphism, and
    all odd elements have the same gap.
\end{lemma}
Thus, for abelian groups, we may denote the shared gap value by $\gamma_\A$.
When the underlying automaton is clear from context, we will simply denote the
gap value by $\gamma$.  It follows that every odd $f$ satisfies $f = (\gamma
\res{f}{1}, \res{f}{1})\sigma$ and every even $f$ satisfies $f = (\res{f}{1},
\res{f}{1})$.

If $\gp(\A)$ is abelian, we will call $\A$ an \emph{abelian automaton}. It
should be noted that \cref{lemma:gap} gives an easy decision procedure to
determine if a given machine $\A$ is abelian. Let $\mathcal B$ be the
minimization of the product machine $\A \times \A^{-1}$. The minimization can
be computed using  a partition-refinement algorithm, where the initial
partition is induced by even and odd states. Then $\A$ is abelian if and only
if the gap of each even state is collapsed to the identity state in $\mathcal
B$ and if the gap of each odd state is collapsed to the same state in $\mathcal
B$.

As a result of \cref{lemma:gap}, each state in a minimal abelian automata has
in-degree at most 3. Otherwise, for some state $q$, there would exist two
states $p_1, p_2$ with edges $p_1 \xrightarrow{\ch{a} / \ch{b}} q$ and $p_2
\xrightarrow{\ch{a} / \ch{b}} q$. But then, because the gap value is fixed, the
$\f{\ch{a}}$-residuals of $p_1$ and $p_2$ must also be equal, implying that
$p_1 = p_2$ and contracting minimality. Thus we have proven the following
proposition.
\begin{prop}\label{prop:in-degree-3}
    If $\A$ is a minimal abelian automaton, then each state in $\A$ has
    at most one in-edge of each label (hence has in-degree at most 3).
\end{prop}

Because there are only three types of edges in abelian automata, it is
convenient to have a shorthand notation for edge labels. For reasons
that will become clear in \cref{sec:field-principal}, we will adopt the
following notation:
\begin{align*}
    p \xrightarrow{0 / 1} q &\text{ is denoted } p \xrightarrow{1} q\\
    p \xrightarrow{1 / 0} q &\text{ is denoted } p \xrightarrow{-1} q\\
    p \xrightarrow{a / a} q &\text{ is denoted } p \xrightarrow{0} q
\end{align*}

This the first example of a combinatorial property of $\A$ that can be deduced
from algebraic properties of $\gp(\A)$. Similar results will be explored
further in \cref{sec:field-principal}.

\subsubsection{One-Toggle Automata}
The simplest class of Abelian automata are those with only one toggle state.
Let $q_1$ be the toggle state. Then each residual of $q_1$ is either the
identity, or it is a copy chain leading back to $q_1$.  Restricting ourselves
to only free abelian, where $\gamma \ne I$, rules out having both residuals be
the identity, and thus we have two basic topologies for these machines: the
sausage automata (\cref{fig:add-n}) and the cycle-cum-chord (CCC) automata
(\cref{fig:ccc-n-m}).

\begin{figure}
    \centering
    \begin{tikzpicture}
        \node[state] (I) {$I$};
        \node[state] (1) [left of = I]{$q_1$};
        \node[state] (n) [below left of = 1] {$q_n$};
        \node[state] (2) [above left of = 1] {$q_2$};
        \node[state] (d) [above left of = n, draw=none] {$\vdots$};
        \path
        (I) edge[loop right] node {$0$} (I)
        (1)
        edge node {$-1$} (I)
        edge[bend left, right] node {\small $1$} (n)
        (n) edge[bend left, left] node {\small $0$} (d)
        (d) edge[bend left, left] node {\small $0$} (2)
        (2) edge[bend left, right] node {\small $0$} (1)
        ;
    \end{tikzpicture}
    \caption{The sausage automaton of rank $n$.}
    \label{fig:add-n}
\end{figure}

\begin{figure}
    \centering
    \begin{tikzpicture}
        \node[state] (1) {$q_1$};
        \node[state] (c) [left of=1, draw=none] {$\cdots$};
        \node[state] (m) [left of=c] {$q_m$};
        \node[state] (d) [left of=m, draw=none] {$\cdots$};
        \node[state] (n) [left of=d] {$q_n$};
        \path
        (1) edge[bend left=25,  above] node {\small $-1$} (n)
        (1) edge[bend right=45, above]  node {\small $1$} (m)
        (n) edge[above] node {\small $0$} (d)
        (d) edge[above] node {\small $0$} (m)
        (m) edge[above] node {\small $0$} (c)
        (c) edge[above] node {\small $0$} (1)
        ;
    \end{tikzpicture}
    \caption{The CCC automaton $\CC^n_m$.}
    \label{fig:ccc-n-m}
\end{figure}

The sausage automaton of rank $n$ is easily seen to generate $\Z^n$ (the
generators $q_1, \ldots, q_n$ are independent).  The groups generated by
the CCC automata are less obvious, however. These were studied in
\cite{jalc170214}, where it was shown that $\gp(\CC^n_m) \cong \Z^{n - \gcd(n,
    m)}$. Furthermore, the authors proved that $\CC^n_m$ is orbit-rational in a
few cases. The general case of this question will be handled in
\cref{sec:abelian-orbit}.

\begin{example}
    $\CC^3_2$ is perhaps the simplest nontrivial abelian automaton. Here we
    have $\gp(\CC^3_2) \cong \Z^2$ with the identity
    $\underline{q_1}^2 \underline{q_2}^2 = \underline{q_3}^{-1}$.
\end{example}

\subsection{SCC Automata}
We now examine the case when $\A$ is a minimal abelian automaton which
is a single strongly connected component. We will exclude the case when
$\A$ is simply the identity state. Let $t \ge 1$ denote the number of toggle
states in $\A$. Write $q_1, \ldots, q_n$ for states of $\A$, where $q_i$ is odd
if $i \le t$. Define $\delta_\A \in \Aut(\bin^*)$ as $\delta_\A = (\gamma_\A,
I)\sigma$.  Like with $\gamma$, when the automaton is clear we will denote
$\delta_\A$ as $\delta$.

\begin{lemma}\label{lemma:delta}
    $\delta \in \gp(\A)$.
    \begin{proof}
        Note that it suffices to show that there exists a state in $\A$ with
        both an even and odd in-edge. Indeed, if $f$ is odd, and $g$ is even
        with $\res{f}{1} = \res{g}{0}$, then $fg^{-1} = \delta$.  Likewise if
        $h$ is odd with $\res{h}{0} = \res{g}{0}$ then $gh^{-1} = \delta$.
        This is shown in \cref{fig:delta-diagram}.
        \begin{figure}[h]
            \centering
            \begin{tikzpicture}[node distance=2cm]
                \node[state] (q) {\small $q$};
                \node[state] (f) [left of = q] {\small $f$};
                \node[state] (g) [above of = q] {\small $g$};
                \node[state] (h) [right of = q]{\small $h$};
                \path
                (f) edge[below] node {\small $-1$} (q)
                (h) edge[below] node {\small $1$} (q)
                (g) edge[right] node {\small $0$} (q)
                (g) edge[left, dashed]
                node[anchor=center, pos=0.45, fill=white]
                    {$\delta$} (f)
                (h) edge[left, dashed]
                node[anchor=center, pos=0.45, fill=white]
                    {$\delta$} (g)
                ;
            \end{tikzpicture}
            \caption{The three possible parents of a state $q$.
            Dashed lines denotes applying the group operation with the
            label.}
            \label{fig:delta-diagram}
        \end{figure}

        We proceed by contradiction. Suppose no state in $\A$ has both an even
        and an odd in-edge. Let $T$ denote the set of states with odd in-edges,
        and $E$ denote the set with even in-edges. By assumption these sets are
        disjoint. By minimality of $\A$, we know $|E| = n - t$, and thus $|T| =
        t$. Then $T$ must have $2t$ total in-edges.  By minimality, each state
        $q \in T$ has in-degree exactly 2. It follows that the action of the
        multiplication by the gap value on the states of $T$ forms a cycle,
        shown below.
        \begin{center}
            \begin{tikzpicture}
                \node[state] (s1) {\small $s_{i_1}$};
                \node[state] (s2) [right of = s1] {\small $s_{i_2}$};
                \node[state] (s3) [right of = s2] {\small $s_{i_3}$};
                \node[state,draw=none] (sd) [right of = s3] {$\cdots$};
                \node[state] (st) [right of = sd] {\small $s_{i_t}$};
                \path
                (s1) edge[below, dashed]
                node[anchor=center, pos=0.42, fill=white] {$\gamma$} (s2)
                (s2) edge[below, dashed]
                node[anchor=center, pos=0.42, fill=white] {$\gamma$} (s3)
                (s3) edge[below, dashed]
                node[anchor=center, pos=0.42, fill=white] {$\gamma$} (sd)
                (sd) edge[below, dashed]
                node[anchor=center, pos=0.42, fill=white] {$\gamma$} (st)
                (st) edge[above, dashed, bend right=25]
                node[anchor=center, pos=0.51, fill=white] {$\gamma$} (s1)
                ;
            \end{tikzpicture}
        \end{center}
        Thus we have $\gamma^k = I$ for some positive integer $k$, contradicting
        the fact that $\gp(\A)$ is free abelian.
    \end{proof}
\end{lemma}

The above proof is sufficient to show $\delta \in \gp(\A)$, but computational
evidence suggests an even stronger topological property in $\A$.
\begin{conj}\label{conj:no-two-toggle}
    For every state $q$ in $\A$, if $q$ has two odd in-edges, then $q$ also
    has an even in-edge.
\end{conj}
This conjecture would imply that $\delta$ may be expressed in exactly $t$
distinct ways as differences of generators of $\A$. We suspect this may
be proven in a similar manner as \cref{lemma:delta}.

We now show that attaching a copy chain to state of $\A$ does not change the
generated group.  For any $f \in \Aut(\bin^*)$, let $\tau(f)$ denote the
automorphism which copies one bit and then applies $f$, that is
$\tau(f) = (f, f)$.
\begin{prop}\label{prop:recurrent}
    $\gp(\A)$ is recurrent. That is, for all $f \in \gp(\A)$,
    $\tau(f) \in \gp(\A)$.
    \begin{proof}
        Because $\tau$ is a homomorphism, it suffices to prove the claim for
        the generators of $\A$. Because $\A$ is an SCC, each state in $\A$ has
        in-degree at least 1. Let $p \xrightarrow{c} q$ be an edge in $\A$.  By
        the preceding lemma, $\delta \in \gp(\A)$ and thus $p \delta^c =
        \tau(q) \in \gp(\A)$.
    \end{proof}
\end{prop}

\begin{cor}\label{cor:back-residuals}
    If $f \in \Aut(\bin^*)$ and $\res{f}{w}$ is a state in $\A$, then
    $f \in \gp(\A)$.
    \begin{proof}
        If $q$ is a state in $\A$, then \cref{prop:recurrent} implies
        $\tau(q) \in \gp(\A)$. Hence, $\delta^{\pm 1} \tau(q) \in \gp(\A)$,
        so all possible predecessors of $q$ are in $\gp(\A)$. Induction
        on $\ch{w}$ gives the desired result.
    \end{proof}
\end{cor}

Note that studying SCC automata does not severely restrict the class of
automaton groups. Let $\A$ be any connected abelian automaton. Let $D$ denote
the condensation of $\A$, i.e. the directed graph induced by the SCCs of $\A$.
$D$ will always have at least one sink, so $\A$ will always have at least one
terminal SCC $\A'$. If this SCC is nontrivial, then by
\cref{cor:back-residuals}, any element of an SCC of $\A$ which can reach $\A'$
is contained in $\gp(\A)$. Hence, by residuating, we see $\gp(\A) = \gp(\A')$.
This proves the following proposition.
\begin{prop}\label{prop:generated-by-terminal}
    If $\A$ has a nontrivial SCC $\A'$, then $\gp(\A) = \gp(\A')$.
\end{prop}

We conclude by stating a lemma which will not be proven entirely until
\cref{sec:field-principal}. It provides futher justification to the separate
study of SCC transducers.
\begin{lemma}\label{lemma:one-terminal-scc}
    Every abelian automaton has only one terminal SCC.
\end{lemma}

\subsection{Principal Automata}\label{sec:principal}
We now move to a class of abelian automata which will play a crucial role the
classification of abelian automaton groups discussed in
\cref{sec:ideal-rep-classification}.

\begin{defn}
    For any abelian automaton $\A$ we call the subautomaton of $\comp(\A)$
    generated by $\delta_\A$ the principal automaton of $\A$, denoted
    $\princ(\A)$.
\end{defn}

Note that $\princ(\A)$ is a subautomaton of $\A \times \A^{-1}$, and thus is
finite. Also, since $\delta = (\gamma, I) \sigma$, the principal automata of
two machines are isomorphic if and only if their gap values are equal.

Principal automata may be the only machines not generated by a terminal SCC.
Indeed, principal automata always have the trivial SCC $I$, and by
\cref{lemma:one-terminal-scc} this is its only terminal SCC.

In fact, proving this property of principal automata would be sufficient to
prove \cref{lemma:one-terminal-scc}, as shown in the following proposition.
\begin{prop}\label{prop:path-exist-gamma-delta}
    If in every principal automaton, there exists a path from $\gamma$ to
    $I$, then \cref{lemma:one-terminal-scc} holds.
    \begin{proof}
        Let $\A$ be a connected abelian automaton. We'll proceed by
        contradiction. Assume there exists two distinct terminal SCCs
        $\A_0$ and $\A_1$. Let $f$ be the lowest common ancestor of
        $\A_0$ and $\A_1$; i.e. $f$ is the state closest to $\A_0$ and
        $\A_1$ which can reach both $\A_0$ and $\A_1$. Thus without
        loss of generality, $f$ is odd, $\res{f}{0}$ leads into $\A_0$ and
        $\res{f}{1}$ leads into $\A_1$.
        \begin{center}
            \begin{tikzpicture}
                \node[state, minimum size=5mm] (f) {\small $f$};
                \node[state, minimum size=5mm] (f0) [above right of=f]
                {\small $\res{f}{0}$};
                \node[state, minimum size=5mm] (f1) [below right of=f]
                {\small $\res{f}{1}$};
                \node[state, minimum size=15mm] (A0) [right of=f0]
                {\large $\A_1$};
                \node[state, minimum size=15mm] (A1) [right of=f1]
                {\large $\A_2$};
                \path
                (f) edge[right, pos=0.3] node {\small $\,\,\,\,1$} (f0)
                (f) edge[right, pos=0.3] node {\small $-1$} (f1)
                (f0) edge[above, dotted] node {} (A0)
                (f1) edge[above, dotted] node {} (A1)
                ;
            \end{tikzpicture}
        \end{center}
        Thus we have $\gamma = \res{f}{0} \res{f}{1}^{-1}$.  Now if for some
        word $\ch{w}$, $\res{\gamma}{w} = I$, then we have $
        \res{\gamma}{w} = \res{f}{0 \cdot w} \res{f}{1 \cdot w}^{-1} = I$, and
        hence $\res{f}{0 \cdot w} = \res{f}{1 \cdot w}$, a contradiction.
    \end{proof}
\end{prop}

In \cref{sec:field-principal} we will prove the preconditions to
\cref{prop:path-exist-gamma-delta}, completing the proof of
\cref{lemma:one-terminal-scc}. We expect that the existence of a path from
$\gamma$ to $I$ admits an easier proof than the one given in given in
\cref{sec:field-principal}, but finding such a proof is left as an open
problem.

Shown in \cref{fig:princ-ccc-3-2} is the principal automaton for $\CC^3_2$.
Note that the machine is skew-symmetric, i.e. that it is its own inverse
machine. This appears to be typical for principal automata, with only one
exception: the sausage automata. Computational evidence supports the
following conjecture:
\begin{conj}\label{conj:skew-symmetry}
    Every principal automaton other than the sausage automata is
    skew-symmetric.
\end{conj}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}
        \tikzstyle{every state}=[
            minimum size = 10mm
        ]
        \node[state] (I)  at (0, 0)   {$I$};
        \node[state] (d)  at (-3, -1) {$\delta$};
        \node[state] (g)  at (-5, -3) {$\gamma$};
        \node[state] (n)  at (-1, -3) {$\nu$};
        \node[state] (D) at (3, -1)  {$\delta^{-1}$};
        \node[state] (G) at (5, -3)  {$\gamma^{-1}$};
        \node[state] (N) at (1, -3)  {$\nu^{-1}$};
        \path
        (I) edge[loop above, above] node {\small $0$} (I)
        (d) edge[above] node {\small $-1$} (I)
        (d) edge[left]  node {\small $1$} (g)
        (g) edge[below] node {\small $0$} (n)
        (n) edge[right] node {\small $-1$} (d)
        (n) edge[bend left, above] node {\small $1$} (N)
        (D) edge[above] node {\small $1$} (I)
        (D) edge[right]  node {\small $-1$} (G)
        (G) edge[below] node {\small $0$} (N)
        (N) edge[left] node {\small $1$} (D)
        (N) edge[bend left, below] node {\small $-1$} (n)
        ;
    \end{tikzpicture}
    \caption{The principal automaton $\princ(\CC^3_2)$. Note the skew-symmetry.
    }
    \label{fig:princ-ccc-3-2}
\end{figure}


\pagebreak
\section{Representations of Automaton Groups}\label{sec:alg-num-theory}
In this section we will discuss algebraic representations of automaton groups
and make connections between algebraic properties of $\gp(\A)$ and the
structure of its generating automata.

\subsection{Matrix Representation}\label{sec:matrix_rep}
When $\gp(\A) \cong \Z^m$, elements of the group may be represented as integer
vectors in $\Z^m$. This section will use this interpretation, and explore the
linear-algebraic properties of the residuation maps.

Let $H \le \gp(\A)$ be the subgroup of even automorphisms. It's clear that $H$
is a subgroup of index 2 and that the residuation maps restricted to $H$ are
homomorphisms into $\gp(\A)$. Maps of this form are known as 1/2-endomorphisms
and were studied by Nekrashevych and Sidki in
\cite{nekrashevych2004automorphisms}. The authors proved that when $\gp(\A)$ is
free abelian, the residuation maps take the form of an affine map.
\begin{thm}\label{thm:nekrashevych_sidki}
    If $\gp(\A) \cong \Z^m$, then there exists an isomorphism $\phi : \gp(\A)
    \rightarrow \Z^m$, an $m \times m$ rational matrix $A$, and a rational
    vector $r$ which satisfy
    \begin{equation}\label{eq:Aresiduals}
        \phi(\res{f}{a}) = \begin{cases}
            A \cdot \phi(f) & \text{if $f$ is even,}\\
            A \cdot \phi(f) + (-1)^a r &
            \text{if $f$ is odd.}\\
        \end{cases}
    \end{equation}
    Also, the matrix $A$ satisfies several interesting properties:
    \begin{itemize}
        \item $A$ is contracting, i.e., its spectral radius is less than 1.
        \item The characteristic polynomial $\chi(z)$ of $A$ is irreducible
            over $\Q$, and has the form $\chi(z) = z^m + \frac{1}{2}g(z)$,
            where $g(z) \in \Z[z]$ is of degree at most $m-1$.
    \end{itemize}
\end{thm}\hfill\\
This theorem gives rise to the \emph{matrix representation} of the group
$\gp(\A)$, parameterized by the matrix $A$ and vector $r$. The fact that $\phi$
is an isomorphism implies that this representation is faithful.

\begin{example}
    $\CC^3_2$ admits the following matrix representation:
    \begin{align*}
        A = \begin{pmatrix}
            -1 & 1\\
            -1/2 & 0
        \end{pmatrix}
        &&
        r = \begin{pmatrix}-1\\-3/2\end{pmatrix}
        &&
        \phi(s_1) = \begin{pmatrix} 1\\0 \end{pmatrix}
    \end{align*}
    The representation of the other states may be obtained by residuation:
    \begin{align*}
        \phi(s_2) = A \phi(s_1) - r = \begin{pmatrix}
            0\\
            1
        \end{pmatrix}
        &&
        \phi(s_3) = A \phi(s_1) + r = \begin{pmatrix}
            -2\\
            -2
        \end{pmatrix}
    \end{align*}
\end{example}

This representation is a useful tool for performing computations in
$\gp(\A)$. Transduction composition is reduced to vector addition and
residuation is reduced to an affine map over $\Z^m$.

However, the matrix representation is not unique. First and foremost, for any
integer vector $e$, let $r' = r + e$. Then one can take a cycle in $\A$ on
some state $q_i$ and translate it into a matrix equation using
\cref{eq:Aresiduals}. If solving this equation for $\Psi(q_i)$ gives an
integer vector, then we have a new matrix representation for $\A$. For
instance, for $\A^3_2$, if we take
\[
    r' = r + \begin{pmatrix}
        -1\\
        1
    \end{pmatrix},
\]
then a cycle on $q_1$ gives the equation
\[
    A (A\Psi(q_1) - r') = \Psi(q_1).
\]
Solving this yields
\[
    \Psi(q_1) = \begin{pmatrix}
        3\\
        1
    \end{pmatrix},
\]
and the other states are then uniquely determined by \cref{eq:Aresiduals}.

Furthermore, the matrix $A$ is may not be unique, even up to $GL(m, \Z)$
similarity.  A theorem of Latimer and MacDuffee implies that the $GL(m, \Z)$
similarity classes of matrices with characteristic polynomial $\chi_A(z)$ are
in one-to-one correspondence with the ideal classes of $\Z[z](\chi_A(z))$
\cite{latimer-macduffee}.  Utilizing computer algebra, we can find an example
with multiple similarity classes.
\begin{example}
    The matrix representations of the automaton $\CC^{15}_8$ have 2
    $GL(m, \Z)$ similarity classes.
\end{example}

Furthermore, it is unclear how one may compute a matrix representation for
a general abelian automaton.

\subsection{Number Field Representation}\label{sec:field-rep}
We now introduce a representation which addresses the above concerns.  We will
show that $\gp(\A)$ can be represented as an additive subgroup of an algebraic
number field $F(\A)$. At this point, it is not clear that $F(\A)$ is unique,
but this will indeed be the case, as shown in
\cref{thm:field_representation_unique}.  In this section, we will use some
basic results from algebraic number theory, see \cite{ireland1990classical,
    stein2012algebraic} for the requisite background.

Suppose $\A$ has states $q_1, \ldots, q_n$. For each state $q_i$, we introduce
an unknown $x_i$, and let $R = \Q[z, x_1, \ldots, x_n]$. For each transition
$s_i \xrightarrow{c} s_j$ in $\A$, we define the polynomial
$p_{i,j} \in R$ as $p_{i,j} = z x_i - x_j + c$, where we are interpreting
$a$ and $b$ as integers for convenience.  Let $\I$ be the ideal of $R$
generated by the set of all such polynomials.  Let $\S$ be the system of
equations defined by $\I$, i.e.\ by setting each $p_{i,j} = 0$.

\begin{lemma}\label{lemma:solution_exists}
    The polynomial system $\S$ has a solution.
    \begin{proof}
        Let $A, r$ be a matrix representation of $\A$ and let $\chi(z)$ be the
        characteristic polynomial of $A$. Define $F = \Q(\alpha)$, where
        $\alpha$ is any root of $\chi(z)$, and let $\phi : \gp(\A) \rightarrow
        \Z^m$ be the matrix representation isomorphism from
        \cref{thm:nekrashevych_sidki}. We will construct a map $\psi: \Z^m
        \rightarrow F$ such that applying $\psi \circ \phi$ to the states of
        $\A$ yields a solution to $\S$.

        Since $\chi(z)$ is irreducible, it's clear that $\mathcal B = \{r, Ar,
        \ldots, A^{m-1}r\}$ is a basis for $\Q^m$.  Define $\psi : \Q^m
        \rightarrow F$ on $\mathcal B$ as $\psi(A^k r) = \alpha^k$.  Then we
        have an injective homomorphism $\Psi: \gp(\A) \rightarrow F$, where
        $\Psi = \psi \circ \phi$.  Now applying $\psi$ to the terms in
        \cref{eq:Aresiduals} gives
        \begin{equation}
            \label{eq:aresiduals} \Psi(\res{f}{a}) = \begin{cases}
                \alpha \Psi(f) & \text{if $f$ is even,}\\
                \alpha \Psi(f) + (-1)^a & \text{if $f$ is odd.}
            \end{cases}
        \end{equation}
        It follows that $\alpha, \Psi(q_1), \ldots, \Psi(q_n)$ is a solution to
        $\S$.
    \end{proof}
\end{lemma}

We now analyze the structure of a general solution to $\S$. For the following
results, let $\alpha$, $\beta_1, \ldots, \beta_n \in \C$ be solutions for $z,
x_1, \ldots, x_n$ respectively. Define the map $\Psi$ on the generators of
$\gp(\A)$ as $\Psi(q_i) = \beta_i$. We first show that residuation behaves as
in \cref{eq:aresiduals}.

\begin{lemma}\label{lemma:residuation}
    For each $f \in \gp(\A)$, \cref{eq:aresiduals} holds.
    \begin{proof}
        The definition of the generators of $\I$ ensures that it holds for the
        generators of $\gp(\A)$. This can be extended to arbitrary products by
        induction on the length of the product. Let $f \in \gp(\A)$, and write
        $f = s \cdot g$, where $s$ is a generator and $g \ne I$. By induction
        we have that both $s$ and $g$ obey \cref{eq:aresiduals}.  Consider the
        possible parities of $s$ and $g$; if both are even, then we have
        \[
            \alpha \Psi(f) =
            \alpha (\Psi(s) + \Psi(g)) =
            \alpha \Psi(s) + \alpha \Psi(g) =
            \Psi(\res{s}{a}) + \Psi(\res{g}{a}) = \Psi(\res{f}{a}).
        \]
        Likewise, if $s$ is odd and $g$ is even, then note $\alpha \Psi(s) =
        \Psi(\res{s}{a}) - (-1)^a$, and so
        \begin{align*}
            \alpha \Psi(f) + (-1)^a =
            \alpha \Psi(s) + \alpha \Psi(g) + (-1)^a =
            \Psi(\res{s}{a}) + \Psi(\res{g}{\f{a}}) =
            \Psi(\res{f}{a}).
        \end{align*}
        The final case follows similarly.
    \end{proof}
\end{lemma}

The preceding lemma shows that residuation is preserved under $\Psi$. This is a
crucially important property that will make the field representation useful for
analyzing $\gp(\A)$. What follows is a sequence of results which shows $\Psi$
faithfully represents $\gp(\A)$, i.e. $\Psi$ is an isomorphism.

\begin{lemma}\label{lemma:z_contraction}
    If $\alpha$ is a solution for $z$ in $\S$, then $|\alpha| < 1$.
    \begin{proof}
        We proceed by contradiction. Let $\beta_i$ be such that $|\beta_i|$ is
        largest. If $q_i$ is even, there would exist an odd state $q_j$ with
        $\beta_j = \alpha^k \beta_i$, $|\beta_j| \ge |\beta_i|$. Thus without
        loss of generality, we may assume $q_i$ is odd. Then one of the
        residuals $\alpha \beta_i \pm 1$ will have absolute value larger than
        $\beta_i$, a contradiction. Thus $|\alpha| < 1$.
    \end{proof}
\end{lemma}

\begin{lemma}\label{lemma:solution_faithful}
    Let $\mathcal L$ be the image of $\gp(\A)$ under $\Psi$. Then
    $\Psi : \gp(\A) \rightarrow \mathcal L$ is an isomorphism.
    \begin{proof}
        We will use results from algebraic number theory to show that the norm
        of elements in $\mathcal L$ can be lower bounded. Because the
        polynomials $p_{i,j}$ are linear with respect to $z$, we know $\beta_i
        \in \Q(\alpha)$ for each $i$. We write $F = \Q(\alpha)$ and $\mathcal
        O_F$ for the ring of integers in $F$, and let $J$ be the fractional
        ideal of $\mathcal O_F$ generated by $\beta_1, \ldots, \beta_n$. Note
        that since $\mathcal L$ is the $\Z$-module generated by $\beta_1,
        \ldots, \beta_n$, $\mathcal L$ is contained in $J$.  Well-known results
        from algebraic number theory show that there exists a nonzero $\zeta
        \in F$ such that $\zeta J \subset \mathcal O_F$
        \cite{stein2012algebraic}. Since each element in $\mathcal O_F$ has
        integral norm, it follows each $\lambda \in \mathcal L$ satisfies
        $|\lambda| \ge \frac{1}{|\zeta|}$.

        We use this fact to show that $\Psi$ is an isomorphism. Suppose for the
        sake of contradiction that there is a non-identity $f \in \gp(\A)$ such
        that $\Psi(f) = 0$. If $f$ is even, then some finite residual
        $\res{f}{w}$ must be odd (because $f$ is non-identity), and
        $\Psi(\res{f}{w}) = \alpha^{|\ch{w}|} \Psi(f) = 0$.  Thus without loss
        of generality, we may assume $f$ is odd. It follows from
        \cref{lemma:residuation} that $\Psi(\res{f}{0}) = 1$, and thus $1 \in
        \mathcal L$.

        \newcommand{\resz}[1]{\partial_{\ch{0}}\,#1}

        Then, by induction, we can show that $\alpha^k \in \mathcal L$ for all
        $k \in \N$. The base case of $k = 0$ follows from the above, and for
        the inductive case let us assume $\alpha^k = \sum_{i = 1}^n c_i
        \beta_i$. Let $\resz{\beta_i}$ denote the $\ch{0}$-residual
        of $\beta_i$.  Then, if $q_i$ is even, we have $\alpha q_i =
        \resz{q_i}$ and if $q_i$ is odd, we have $\alpha q_i =
        \resz{q_i} - 1$. It follows that
        \begin{align*}
            \alpha^{k+1} = \alpha \sum_{i = 1}^n c_i \beta_i =
            \sum_{i = 1}^n c_i \resz{\beta_i} - \sum_{i = 1}^n c_i,
        \end{align*}
        Because $1 \in \mathcal L$, we conclude that the constant
        term $\sum_{i = 1}^n c_i \in \mathcal L$, implying that $\alpha^{k+1}
        \in \mathcal L$. Thus, by \cref{lemma:z_contraction}, there are
        arbitrarily small nonzero elements in $\mathcal L$, which contradicts
        the preceding paragraph.  Thus, if $\Psi(f) = 0$, then $f$ must be the
        identity, implying that $\Psi$ is an isomorphism.
    \end{proof}
\end{lemma}

The preceding lemma shows that each solution to $\S$ is capable of faithfully
representing $\gp(\A)$ in its corresponding number field
$\Q[z] / (\mu(z))$, where $\mu(z)$ is the minimal polynomial of $\alpha$
in this solution.  The following theorem proves that these solutions are
equivalent up to conjugates of $\alpha$, and thus $\alpha$ has a unique
minimal polynomial.

\begin{thm}\label{thm:field_representation_unique}
    There exists a unique irreducible polynomial $\chi(z)$ such that $\A$
    admits a field representation in $F(\A) = \Q[z] / (\chi(z))$.
    Specifically, there exists an injective homomorphism $\Psi: \gp(\A)
    \rightarrow F(\A)$ such that for all $f \in \gp(\A)$,
    \begin{equation} \label{eq:zresiduals}
        \Psi(\res{f}{a}) = \begin{cases}
            z \Psi(f) & \text{if $f$ is even,}\\
            z \Psi(f) + (-1)^a & \text{if $f$ is odd.}
        \end{cases}
    \end{equation}
    \begin{proof}
        Let $\alpha, \beta_1, \ldots, \beta_n$ be solutions to $\S$ for the
        unknowns $z, x_1, \ldots, x_n$ respectively. Let $\gamma$ be the gap
        value for $\A$ discussed in \cref{sec:matrix_rep}.  From
        \cref{lemma:residuation}, it is clear that $\Psi(\gamma) = 2$. Let
        $\zeta_k$ be any length-$k$ residual of $\gamma$, so that
        $\Psi(\zeta_i)$ is a polynomial in $\alpha$ of degree $k$. Thus, if
        $\gp(\A)$ has rank $m$, then $\gamma, \zeta_1, \ldots, \zeta_{m}$ are
        linearly dependent. Under $\Psi$, this shows that $\alpha$ is a root of
        a degree $m$ polynomial. This polynomial has the same degree as the
        irreducible $\chi(z)$ from \cref{lemma:solution_exists}, proving that
        $\alpha$ satisfies $\chi(\alpha) = 0$. Hence, all solutions to $\S$ are
        equivalent up to conjugates of $\alpha$, which implies there is a
        unique solution in $F(\A) = \Q[z] / (\chi(z))$.
    \end{proof}
\end{thm}

The existence of a unique solution addresses one of the issues mentioned with
the matrix representation. What remains is to show the representation is
efficiently computable.

\begin{thm}\label{thm:field_representation_efficient}
    The field representation can be computed in time $O(n^6)$.
    \begin{proof}
        We seek to compute $\chi(z)$ along with the unique solution to $\S$ as
        elements of $F(\A)$. By \cref{thm:field_representation_unique},
        computing a triangular decomposition of $\I$, with respect to the
        lexicographic monomial ordering on $x_1 < \cdots < x_n < z$, would
        yield $\chi(z)$ as the first element \cite{LAZARD1992117}.  The values
        for $x_i$ may then be computed by solving the linear system in $F(\A)$.

        The work required to compute a triangular decomposition is dominated by
        the calculation of a Gr\"obner basis for $\I$ \cite{LAZARD1992117}.  In
        general, Gr\"obner basis calculation is known to be EXPSPACE-complete.
        However, the nearly-linear structure of the equations in $\I$ allow for
        better upper bounds on the complexity. It follows from
        \cite{faugere2011grobner} that the $F_5$ algorithm can compute a
        Gr\"obner basis for $\I$ in time $O(n^6)$.
    \end{proof}
\end{thm}

\begin{example}\label{example:field-cc-3-2}
    The polynomial ideal for $\CC^3_2$ is
    \[
        \I = (zx_1 + 1 = x_3, zx_1 - 1 = x_2, zx_3 = x_2, z x_2 = x_1).
    \]
    A triangular decomposition gives
    \[
        \I = (z^2 + z + 1/2, 5*x_1 - 4*z - 8, 5*x_2 + 6*z + 2, 5*x_3 - 4*z + 2).
    \]
    Thus $\chi(z) = z^2 + z + 1/2$. Letting $\alpha$ denote a root of
    $\chi(z)$, we have
    \begin{align*}
        \Psi(q_1) = \frac{1}{5}\paren{-6 \alpha - 2},
        &&
        \Psi(q_2) = \frac{1}{5}\paren{4 \alpha - 2},
        &&
        \Psi(q_3) = \frac{1}{5}\paren{4 \alpha + 8}.
    \end{align*}
\end{example}

\subsection{Algebraic Structure of Principal Automata}\label{sec:field-principal}
In this section we will examine the structure of the principal automata
from the lens of its algebraic number field.

Unlike the previous section, here we will let $\alpha$ denote the reciprocal of
the solution for $z$ in $\S$. Note that we still have $F(\A) = \Q(\alpha)$.
It follows from \cref{thm:nekrashevych_sidki} that the minimal polynomial of
$\alpha$ is of the form $\chi^{-1}(z) = z^m + c_{m-1}z^{m-1} + \cdots + c_1 z 
\pm 2$ where $c_i \in \Z$, so $\alpha$ is an algebraic integer.  Let $\Psi:
\gp(\A) \rightarrow F(\A)$ be the map constructed in the previous section.
\begin{prop}\label{prop:delta_alpha}
    $\Psi(\delta) = \alpha$.
    \begin{proof}
        Since $\res{\delta}{1} = I$, by \cref{eq:aresiduals}
        we have $\alpha^{-1} \Psi(\delta) - 1 = 0$.
    \end{proof}
\end{prop}

\begin{figure}[h]
    \centering
    \begin{tikzpicture}[node distance=2cm]
        \tikzstyle{every state}=[
            minimum size = 9mm
        ]
        \node[state] (0)  {\small $0$};
        \node[state] (a)  [below left of=0] {\small $\alpha$};
        \node[state] (a2) [left of = a] {\small $\alpha^2$};
        \node[state] (a3) [left of = a2] {\small $\alpha^3$};
        \node[state] (d)  [left of = a3, draw=none] {\small $\cdots$};
        \node[state] (g)  [below right of=a] {\small $2$};
        \node[state] (c)  [right of = g, draw=none]{\small $\cdots$};
        \path
        (0)  edge[loop above, above] node {\small $0$} (0)
        (a)  edge[right, pos=.2] node {\small $-1$} (0)
        (a)  edge[right, pos=.2] node {\small $\,\,\,\,1$} (g)
        (a2) edge[above] node {\small $0$} (a)
        (a3) edge[above] node {\small $0$} (a2)
        (d)  edge[above] node {\small $0$} (a3)
        (g)  edge[above] node {} (c)
        ;
    \end{tikzpicture}
    \caption{The copy chain attached to $\alpha$, leading into $\princ(\A)$.}
    \label{fig:princ-copy-chain}
\end{figure}

Consider the copy chain in $\comp(\A)$ rooted at $\delta$. This is shown in
\cref{fig:princ-copy-chain} with the states labeled with their image under
$\Psi$.
\begin{lemma}\label{lemma:princ-copy-chain-gen}
    $\gp(\princ(\A))$ is generated by
    $\delta, \tau(\delta), \ldots, \tau^{m-1}(\delta)$.
    \begin{proof}
        Let $G = \langle \tau^i(\delta) \mid 0 \le i < m \rangle$.
        We have $\Psi(\tau^i(\delta)) = \alpha^i$. Evaluating $\alpha$ at its
        minimal polynomial shows
        \[
            \pm 2 = \alpha^m + c_{m-1}\alpha^{m-1} + \cdots + c_1 \alpha
        \]
        and hence $\gamma \in G$. Thus for $\ch{a} \in \bin$,
        $\res{\gamma}{a} \in \langle \gamma, G \rangle = G$, and by induction
        every state of $\princ(\A)$ is contained in $G$. Thus
        $\gp(\princ(\A)) \subseteq G$. The other containment follows from
        \cref{cor:back-residuals}.
    \end{proof}
\end{lemma}

\begin{example}
    The diagram of $\princ(\CC^3_2)$ is shown in \cref{fig:princ-ccc-3-2}.  We
    have $\nu = \tau(\delta)\delta^{-1}$ and $\gamma = \tau(\delta)^{-1}
    \tau(\delta)^{-2}$, so $\gp(\princ(\CC^3_2)) = \langle \delta, \tau(\delta)
    \rangle$.
\end{example}

Recall that \cref{prop:path-exist-gamma-delta} shows that, in order to prove
\cref{lemma:one-terminal-scc}, it suffices to show that $\princ(\A)$ must
contain a path from $\gamma$ to $I$. We will use the concept of Knuth normal
form for elements of $\gp(\A)$ explained in \cite{Sutner18:abelian_automata}
and summarized below.
\begin{defn}
    A (weak) Knuth normal form for an element $f \in \gp(\princ(\A))$ is an
    expansion
    \[
        \Psi(f) = \sum_{i=1}^k d_i \alpha^i
    \]
    where each $d_i \in \{-1, 0, 1\}$. We call $k$ the length of the Knuth
    normal form for $f$.
\end{defn}

Recall from the proof of \cref{lemma:solution_faithful} that $\pm 1$ cannot be
in the image of $\gp(\A)$ under $\Psi$. Therefore, in a Knuth normal form, we
could never have a constant term, and thus the sum starts at index 1.  We make
the following observation.
\begin{prop}\label{prop:knf_tame}
    $f$ admits a Knuth normal form if and only if $f$ has a path to $I$.
    \begin{proof}
        We will show that the digits of the Knuth normal form of $f$ specify
        the path from $f$ to $I$.
        Suppose $\Psi(f) = \sum_{i=1}^k d_i \alpha^i$. Then the map
        \[
            f \mapsto \begin{cases}
                \res{f}{0} & \text{if $d_1 \in \{-1, 0\}$},\\
                \res{f}{1} & \text{otherwise}.
            \end{cases}
        \]
        reduces the length of the Knuth normal form by 1, in particular by
        shifting the coefficients as follows:
        \[
            (d_k, d_{k-1}, \ldots, d_2, d_1) \mapsto
            (0, d_k, \ldots, d_3, d_2)
        \]
        Iterating the above map $k$ times (using the trailing coefficient as
        $d_0$ on each iteration) yields all zero coefficients, and hence we
        have constructed a path to the identity state.

        Conversely, if $f$ has a path to $I$ of length $k$, then let
        $d_1, \ldots, d_{k}$ be the edge labels traversed on the path. It
        follows that
        \[
            f = \delta^{d_1} \cdots \tau^k(\delta)^{d_k},
        \]
        and thus $f$ admits the Knuth normal form
        $\Psi(f) = \sum_{i=1}^k d_i \alpha^i$.
    \end{proof}
\end{prop}

Thus, to prove \cref{lemma:one-terminal-scc} it suffices to show $\gamma$
admits a Knuth normal form. We will achieve this by invoking a result from the
study of numeration systems in algebraic number fields. For background,
see \cite{Pethoe09:radix_representations} and the references therein.

The following result follows from \cite{LagariasWang96:tiles,
    LagariasWang97:integral_tiles}.
\begin{thm}\label{thm:lagarias_wang}
    Let $\alpha$ be an expanding algebraic integer of norm 2. Then for every
    $\beta \in \Z[\alpha]$ may be written as
    $\beta = \sum_{i < k} d_i \alpha^i$, where $d_i \in \{-1, 0, 1\}$.
\end{thm}

\begin{cor}\label{cor:principal-tame}
    Every element of $\gp(\princ(\A))$ admits a Knuth normal form.
    \begin{proof}
        By \cref{lemma:princ-copy-chain-gen}, the image of $\gp(\princ(\A))$
        under $\Psi$ is contained in $\Z[\alpha]$, satisfying the preconditions
        for \cref{thm:lagarias_wang}.
    \end{proof}
\end{cor}

The above corollary finishes the proof of \cref{lemma:one-terminal-scc}.

\subsection{Ideal Classification}\label{sec:ideal-rep-classification}
In this section we will classify abelian automaton groups as fractional ideals
of particular form in their corresponding field. We refer the reader to
\cite{stein2012algebraic} for background on ideal arithmetic and fractional
ideals.

We will work under the assumption of a conjecture which is well supported by
computational evidence.  Let $\alpha$ be such that $F(\A) = \Q(\alpha)$, and
let $\mathcal{O}_\A$ be the ring of integers of $F(\A)$.
\begin{conj}\label{conj:power_basis}
    $F(\A)$ is monogenic. That is, $\mathcal{O}_\A = \Z[\alpha]$.
\end{conj}

As in \cref{sec:field-rep}, let $\beta_1,\ldots,\beta_n$ be the images of
the states of $\A$ in $F(\A)$. Let $L$ be the integral span of
$\beta_1,\ldots,\beta_n$, so $L \cong \gp(\A)$. Let $J$ be the fractional ideal
of $\mathcal{O}_\A$ generated by $\beta_1,\ldots,\beta_n$. The above
conjecture, if true, implies that $L = J$.
\begin{cor}
    $L = J$
    \begin{proof}
         It's clear that $L \subseteq J$, because $\Z \subset \mathcal{O}_\A$.
         By \cref{conj:power_basis}, to show $J \subseteq L$, it suffices to
         show that $\beta \in L \implies \alpha \beta \in L$. This follows from
         the fact that $\gp(\A)$ is recurrent, i.e. \cref{prop:recurrent}.
    \end{proof}
\end{cor}
This shows that we may associate to $\gp(\A)$ a fractional ideal of
$\mathcal{O}_\A$. Let $\ideal(\A)$ denote this map from abelian automata to
fractional ideals. Let $\princ$ be the principal automaton of $\A$, and recall
that $\gp(\princ) \subseteq \gp(\A)$. As one would expect, this fact holds for
the fractional ideals as well. We first characterize the fractional ideal
$\ideal(\princ)$.
\begin{lemma}\label{lemma:princ-ideal-alpha}
    $\ideal(\princ) = (\alpha)$, the principal ideal generated by $\alpha$.
    \begin{proof}
        By \cref{lemma:princ-copy-chain-gen}, $\Psi(\gp(\princ)) =
        \alpha \Z[\alpha]$, and \cref{conj:power_basis} implies
        $\alpha \Z[\alpha] = (\alpha)$.
    \end{proof}
\end{lemma}
\begin{lemma}\label{lemma:alpha_ideal_index_2}
    The ideal $(\alpha)$ has norm two. That is,
    $[\mathcal{O}_\A : (\alpha)] = 2$.
    \begin{proof}
        Because the gap value is in $\gp(\princ)$, we have
        $2 \in \Psi(\gp(\princ))$. Hence all even rational integers are in
        $(\alpha)$. By \cref{conj:power_basis}, it follows that $(\alpha)$
        contains all elements of the form
        \[
            \alpha \Z[\alpha] + 2 \Z
        \]
        and hence $(\alpha)$ has norm 2.
    \end{proof}
\end{lemma}
\begin{cor}\label{cor:alpha_prime_ideal}
    $(\alpha)$ is a prime ideal of $\mathcal{O}_\A$.
    \begin{proof}
        The norm of $(\alpha)$ is prime, and ideal norms are multiplicative.
    \end{proof}
\end{cor}

Recall that $\mathcal{O}_\A$ is a Dedekind domain, and hence we have unique
factorization of any fractional ideal $J$ as
\[
    J = (\mathfrak{p}_1^{a_1} \cdots \mathfrak{p}_k^{a_k})
    \cdot
    {(\mathfrak{p}_{k+1}^{a_{k+1}} \cdots \mathfrak{p}_n^{a_n})}^{-1}
\]
where the ideals $\mathfrak{p}_i$ are distinct.

\begin{defn}\label{defn:residually_closed}
    A fractional ideal $J$ of $\mathcal O_\A$ is called residually closed if
    \begin{equation}\label{eq:residually-closed}
        J = (\alpha) J + (\alpha)
    \end{equation}
\end{defn}

\begin{thm}\label{thm:ideal_structure}
    A fractional ideal $J$ is the image of an abelian automaton group if and
    only if it is residually closed. In this case, we have that for some $\A$,
    \[
        J = \ideal(\A) = (\alpha) \cdot \mathfrak{b}^{-1}
    \]
    for a unique ideal $\mathfrak{b}$ of $\mathcal{O}_\A$ which is relatively
    prime to $(\alpha)$.

    \begin{proof}
        First note that $\ideal(\princ)$ is always residually closed.
        The set $(\alpha) \ideal(\princ) + (\alpha)$ contains the image of all
        possible predecessors of an element of $\gp(\A)$, and hence is equal to
        $\ideal(\princ)$.

        Conversely suppose $J$ is a residually closed fractional ideal.
        Then $J = (\alpha) (J + \mathcal O_\A)$, so $(\alpha)$ divides
        $J$. Thus $J$ contains the image of a principal automaton group and
        is closed under backwards residuation, so $J$ is the image of an
        abelian automaton group.

        For any residually closed ideal $J$, by unique factorization we have
        $\ideal(\A) = (\alpha) \mathfrak{a} \cdot \mathfrak{b}^{-1}$, where
        either $\mathfrak{a} = \mathcal O_\A$ or else $\mathfrak{a}$ and
        $\mathfrak{b}$ are relatively prime. We will show that only
        $\mathfrak{a} = \mathcal O_\A$ is possible. Suppose otherwise. Then, we
        divide \cref{eq:residually-closed} by $J$ to find
        \[
            (\alpha) + (\alpha)J^{-1} = \mathcal O_\A
        \]
        and thus
        \[
            (\alpha) + \mathfrak{b} \mathfrak{a}^{-1} = \mathcal O_\A
        \]
        Because $(\alpha) \subset \mathcal O_A$, we must have
        $\mathfrak{b} \mathfrak{a}^{-1} \subseteq \mathcal O_\A$, contradicting
        the fact that $\mathfrak{a}$ and $\mathfrak{b}$ are relatively prime.
        Thus we conclude $J = (\alpha) \mathfrak{b}^{-1}$.
    \end{proof}
\end{thm}

\cref{thm:ideal_structure} implies that we may apply unique factorization of
ideals to observe properties of automaton groups. In particular, we have the
following corollaries:

\begin{cor}\label{cor:intermediate-ideal-factors}
    Let $J_1, \ldots, J_k$ be fractional ideals such that
    \[
        (\alpha) = J_1 \subsetneq \cdots \subsetneq J_k = \ideal(\A)
    \]
    where all $J_i \subsetneq J_{i+1}$.  Then for all $i$ with $1 \le i \le k$
    there there exists an abelian automaton $\A_i$ such $J_i = \ideal(\A_i)$
    and
    \[
        \gp(\princ(\A)) = \gp(\A_1) \subsetneq \cdots \subsetneq
        \gp(\A_k) = \gp(\A)
    \]
    where all $\gp(\A_i) \subsetneq \gp(\A_{i+1})$.
\end{cor}

\begin{cor}\label{cor:group-unique-factorization}
    Let $\A_1$ and $\A_2$ be two abelian automata.  If $\princ(\A_1) \cong
    \princ(\A_2)$, then $\ideal(\A_1) = \mathfrak{q} \ideal(\A_2)$ for some
    fractional ideal $\mathfrak{q}$.
    \begin{proof}
        By \cref{thm:ideal_structure}, we have
        $\ideal(\A_1) = (\alpha) \mathfrak{b}_1^{-1}$ and
        $\ideal(\A_2) = (\alpha) \mathfrak{b}_2^{-1}$. Then
        \[
            \ideal(\A_1) \ideal(\A_2)^{-1} = \mathfrak{b}_2 \mathfrak{b}_1^{-1}
        \]
    \end{proof}
\end{cor}

\pagebreak
\section{Orbit Rationality}
\subsection{Background}
We briefly return to the case of a general (possibly nonabelian) automaton
group.  For $f \in \gp(\A)$ and $\ch{x} \in \bin^*$, we define the \emph{orbit}
of $\ch{x}$ under $f$, denoted $f^*(\ch{x})$, as the set of iterates of $f$
applied to $\ch{x}$, $\{f^t \ch{x} \mid t \in \Z\}$. Following this, we define
the \emph{orbit language} of $f$ as
\[
    \orb(f) = \{\ch{x} {:} \ch{y} \mid \exists t \in \Z \text{ such that }
    f^t \ch{x} = \ch{y}\},
\]
where the \emph{convolution} $\ch{x} {:} \ch{y}$ of two words $\ch{x}, \ch{y}
\in \bin^k$ is defined by
\[
    \ch{x} {:} \ch{y} = \begin{tabular}{|c|c|c|c|}
        \hline
        $\ch{x_1}$ & $\ch{x_2}$ & $\ldots$ & $\ch{x_k}$\\
        \hline
        $\ch{y_1}$ & $\ch{y_2}$ & $\ldots$ & $\ch{y_k}$\\
        \hline
    \end{tabular} \in (\bin \times \bin)^k.
\]
We concern ourselves with the following question: Given $\ch{x}, \ch{y} \in
\bin^*$, is $\ch{x} {:} \ch{y} \in \orb(f)$? We'll call automorphisms
\emph{orbit-rational} if their orbit language is regular (and hence their orbit
relation is rational).  Consider the \emph{orbit with translation language} as
defined in
\cite{jalc170214}:
\[
    \R(f,g) =
    \{\ch{x} {:} \ch{y} \mid \exists t \in \Z \text{ such that } g f^t
    \ch{x} = \ch{y}\}.
\]
It was shown that $\R$ is closed under quotients. Precisely, if
$f, g \in \gp(\A)$ and $\ch{b} = g \ch{a}$, then
\begin{align*}
    (a {:} b)^{-1} \R(f, g) &=
    \begin{cases}
        \R(\res{f}{a}, \res{g}{a}) & \text{if $f$ is even,}\\
        \R(\res{f}{a}\res{f}{\f{a}}, \res{g}{a}) & \text{if $f$ is odd.}
    \end{cases}\\
    (a {:} \f{b})^{-1} \R(f, g) &=
    \begin{cases}
        \emptyset & \text{if $f$ is even,}\\
        \R(\res{f}{a}\res{f}{\f{a}}, \res{f}{a}\res{g}{\f{a}}) &
        \text{if $f$ is odd.}
    \end{cases}
\end{align*}
Consider the infinite transition system $M_\A$ over $\bin \times \bin$ and
with transitions
\[
    \R(f, g) \xrightarrow{\ch{a} {:} \ch{b}} (\ch{a} {:} \ch{b})^{-1} \R(f,g).
\]
For any $f \in \gp(\A)$, $\R(f, I)$ is the orbit language for $f$, and thus $f$
is orbit-rational if and only if the subautomaton of $M_\A$ reachable from $(f,
I)$ is finite. Because $\gp(\A)$ is contracting (see \cref{sec:matrix_rep}),
this occurs if and only if finitely many first arguments to $\R$ appear in the
closure of $\R(f, I)$ under residuation. The first arguments of the quotients
depend only on the input bit $\ch{a}$, which leads us to consider the maps
\[
    \varphi_{\ch{a}}(f) = \begin{cases}
        \res{f}{a} & \text{if $f$ is even,}\\
        \res{f}{a}\res{f}{\f{a}} & \text{if $f$ is odd.}
    \end{cases}
\]
Thus, to determine if $f$ is orbit-rational, it suffices to determine the
cardinality of the set resulting from iterating $\varphi_{\ch{0}}$,
$\varphi_{\ch{1}}$ starting at $f$.


\subsection{The Abelian Case}\label{sec:abelian-orbit}
Throughout this section we will assume $\A$ is abelian. In this case, we have
$\varphi_a = \varphi_{\f{a}}$, so we will drop the subscript and simply refer
to $\varphi$. If $f$ is odd, then $f = (\gamma \res{f}{1}, \res{f}{1}) \sigma$,
where $\gamma$ is the gap value of $\A$.  Then, $\varphi(f) = \gamma
\res{f}{1}^2$, and
\begin{equation}\label{eq:abelianorbitresid}
    \varphi(f) = \begin{cases}
        \res{f}{0} & \text{if $f$ is even,}\\
        \gamma \res{f}{1}^2 & \text{if $f$ is odd.}
    \end{cases}
\end{equation}

We seek to understand the behavior of iterating $\varphi$ on an automorphism,
and in particular, determine when $\varphi^*(f) = \{\varphi^t (f) \mid t \in
\N\}$ is finite.  To accomplish this, will return to the wreath representation
for automorphisms and relate $\varphi$ to an extension of parity for
automorphisms in $\gp(\A)$.

\begin{defn}
    The even rank of an automorphism $f \in \gp(\A)$, denoted $\rk{f}$, is
    defined as the minimum integer $k$ such that $\varphi^k(f)$ is odd. If
    there is no such integer, then $\rk{f} = \infty$.
\end{defn}

When the context is clear, we will abbreviate ``even rank'' as ``rank''.  It is
clear that when $f$ is even, $\varphi(f) = \res{f}{0} = \res{f}{1}$, so the
rank equivalently measures the distance from $f$ to its first odd residual. If
$f$ has infinite rank, then for every $w \in \bin^*$, the residual $\res{f}{w}$
is even. Thus $f \ch{x} = \ch{x}$ for all $\ch{x} \in \bin^*$, implying that
the only automorphism with infinite rank is the identity. We will now prove the
primary connection between rank and $\varphi$: that rank equality is preserved
under $\varphi$.
\begin{lemma}\label{lemma:rank_varphi}
    If $f, g \in \gp(\A)$ with $\rk{f} = \rk{g}$, then
    $\rk{\varphi(f)} = \rk{\varphi(g)}$.
    \begin{proof}
        The case when $\rk{f} > 0$ is clear, but if $\rk{f} = 0$, then we may
        write $f$ in wreath representation as $f = (\gamma h, h) \sigma$, where
        $\gamma$ is the gap value discussed in \cref{sec:matrix_rep}, and it
        follows that $\varphi(f) = \gamma h^2$.

        If we had $\rk{\gamma} < \rk{h^2}$, it would follow that
        $\rk{\varphi(f)} = \rk{\gamma}$, so it suffices to show this
        inequality. Indeed, since $h^2$ is even and $h^2 = (\gamma
        \res{h}{1}^2, \gamma \res{h}{1}^2)$, we have
        \[
            \rk{h^2} \ge 1 + \min(\rk{\gamma}, \rk{\res{h}{1}^2}).
        \]
        This inequality would hold for any square $h^2$; in particular, it also
        holds for $\res{h}{1}^2$. It follows that the $\min$ takes value
        $\rk{\gamma}$, so $\rk{h^2} \ge 1 + \rk{\gamma}$. Thus, for any odd
        $f$, $\rk{\varphi(f)} = \rk{\gamma}$, which completes the proof.
    \end{proof}
\end{lemma}

This result allows us to begin to understand the conditions under which
$\varphi^*(f)$ will be finite. We first show that $\varphi$-orbits are periodic
when $f$ is odd.

\begin{cor}\label{cor:odd_finite_repeat}
    If $f$ is an odd automorphism and $t = |\varphi^*(f)|$ is finite, then
    $\varphi^t (f) = f$.
    \begin{proof}
        Because $|\varphi^*(f)|$ is finite, the sequence $\{\varphi^n(f) | n
        \ge 0\}$ is eventually periodic. \cref{lemma:rank_varphi} shows
        iterating $\varphi$ on $f$ produces a cyclic sequence of ranks of the
        form $0, \rk{\gamma}, \rk{\gamma} - 1, \ldots, 0, \ldots$.  We note
        that $\varphi$ is invertible when restricted to the automorphisms of
        rank at most $\rk{\gamma}$. Indeed, for any automorphism $g$, if
        $\rk{g} < \rk{\gamma}$, then the unique inverse is $\varphi^{-1}(g) =
        (g, g)$. If instead $\rk{g} = \rk{\gamma}$, there is a unique odd $h$
        such that $g = \varphi(h) = \gamma \res{h}{1}^2$.  It follows that the
        first repeated automorphism in $\varphi^*(f)$ is $f$ itself, so
        $\varphi^t(f) = f$.
    \end{proof}
\end{cor}

The preceding results can be interpreted in the field representation of the
group.  Recall the map $\Psi : \gp(\A) \rightarrow F(\A)$ satisfying the
properties described in \cref{sec:field-rep}. Let $\chi(z)$ be the unique
characteristic polynomial for $\A$, and let $\alpha$ be a root of $\chi$ such
that $F(\A) = \Q(\alpha)$. Let $\mathcal L = \Psi(\gp(\A))$ be the image of the
group elements in $F(\A)$. Then $\Gamma = \Psi \varphi \Psi^{-1}$ is the orbit
residuation map in $\mathcal L$, so $|\varphi^*(f)| = |\Gamma^*(\Psi(f))|$, and
it follows from \cref{eq:abelianorbitresid} that for any $\beta \in \mathcal
L$,
\[
    \Gamma(\beta) = \begin{cases}
        \alpha \beta & \text{if $\Psi^{-1} \beta$ is even,}\\
        2\alpha \beta & \text{if $\Psi^{-1} \beta$ is odd.}
    \end{cases}
\]

\begin{lemma}\label{lemma:2alphakn_eq1}
    If $f \in \gp(\A)$, $f \ne I$, and $\varphi^*(f)$ is finite, then
    $(2 \alpha^k)^n = 1$ for some $k, n \in \N$. Furthermore, $\varphi^*(g)$ is
    finite for any $g \in \gp(\A)$.
    \begin{proof}
        Suppose $\varphi^*(f)$ is finite. Because any non-identity $f$ has
        finite rank, if we let $f' = \varphi^{\rk{f}}(f)$, then $f'$ is odd and
        $\varphi^*(f')$ is finite.

        By~\cref{cor:odd_finite_repeat}, we may write $\varphi^t(f') = f'$.
        Let $h$ be the first odd automorphism after $f'$ in the sequence
        $\{\varphi^n(f') \mid n \ge 0\}$, say $\varphi^k(f') = h$. So in
        $F(\A)$,
        \[
            \Gamma^k \Psi(f') = 2\alpha^k \Psi(h).
        \]
        Then by~\cref{lemma:rank_varphi}, the sequence of parities starting
        from $f'$ and $h$ are identical, meaning that any odd state reachable
        by $f'$ must be of the form $\varphi^{kn}(f')$. Thus taking $n =
        \frac{t}{k}$ shows $(2 \alpha^k)^n \, \Psi(f') = \Psi(f')$. Since $f'
        \ne I$, it follows that $\Psi(f') \ne 0$, and so $(2 \alpha^k)^n = 1$
        in $F(\A)$.  Now if $g \in \gp(\A)$ with $g \ne I$, then $g' =
        \varphi^{\rk{g}}$ is odd, and \[ \Gamma^{kn}(\Psi(g)) = (2\alpha^k)^n
            \, \Psi(g) = \Psi(g), \] so $\varphi^{kn}(g) = g$, and hence
        $\varphi^*(g)$ is finite.
    \end{proof}
\end{lemma}
\begin{lemma}\label{lemma:rational_nth_root}
    Some power of $\alpha$ is rational if and only if for some $k, n \in \N$,
    $(2 \alpha^k)^n = 1$. In this case, $\alpha$ has magnitude
    $2^{-\frac{1}{m}}$, where $m$ is the rank of the free abelian group
    $\gp(\A)$.
    \begin{proof}
        First assume that $(2 \alpha^k)^n = 1$ for some integers $k$ and $n$.
        Then $\alpha^{kn} = 2^{-n}$.  Conversely let $\ell$ be smallest such
        that $\alpha^{\ell} = r$ is rational. Then $\alpha$ is a root of $p(z)
        = z^\ell - r$.  Let $\chi(z)$ be the irreducible characteristic
        polynomial of $\A$.  Since $\chi$ is the minimal polynomial of
        $\lambda_0$, then $\chi(z) \mid p(z)$. Thus all roots of $\chi$ have
        equal magnitude, and since the constant term of $\chi(z)$ is $\pm
        \frac{1}{2}$, this magnitude is $|\alpha| = \pm 2^{-\frac{1}{m}}$,
        where $m$ is the rank of $\gp(\A)$.  Since $\lambda^\ell = r$ has
        rational norm, $m$ divides $\ell$.  Setting $k = m$ and $n =
        \frac{2\ell}{m}$ guarantees that $(2\alpha^k)^n = 1$.
    \end{proof}
\end{lemma}
The preceding lemmas directly imply our main result concerning orbit
rationality:
\begin{thm}\label{thm:orbit_rational_power}
     Let $\chi(z)$ be the unique characteristic polynomial for $\A$, and let
     $\alpha$ be a root of $\chi$ such that $F(\A) = \Q(\alpha)$.  Then for any
     $f \in \gp(\A)$, $f$ is orbit-rational if and only if some power of
     $\alpha$ is rational.
\end{thm}

\begin{example}
    $\CC^3_2$ is orbit rational. Recall from \cref{example:field-cc-3-2} that
    $F(\CC^3_2) = \Q[z] / (\chi(z))$ for $\chi(z) = z^2 + z + 1/2$.  If
    $\alpha$ is a root of $\chi(z)$, then $\alpha^4 = -1/4$.
\end{example}

\subsection{Decision Procedure}
We aim to turn~\cref{thm:orbit_rational_power} into a decision procedure for
orbit rationality. Computationally, we must decide if some power of $\alpha$ is
rational. The following result shows that it suffices to check only one power
of $\alpha$.

\begin{lemma}\label{lemma:charpoly_restriction}
    Some power of $\alpha$ is rational if and only if $\alpha^{4\ell}$ is
    rational, where
    \[
        \ell = \begin{cases}
            \frac{m}{2} & \text{if $m$ is odd,}\\
            m & \text{otherwise.}
        \end{cases}
    \]
    \begin{proof}
        By~\cref{lemma:rational_nth_root}, all roots of $\chi(z)$ have norm
        $2^{-\frac{1}{m}}$ and therefore lie on the complex disk of radius
        $2^{-\frac{1}{m}}$. We will follow a technique of Robinson in
        \cite{Robinson1969} to show $\chi(z)$ is of the form $P(z^\ell)$,
        where $P$ has degree at most 2. We write
        \[
            \chi(z) = a_m x^m + a_{m-1}x^{m-1} + \cdots + a_1 x + a_0,
        \]
        where $a_m = 1$ and $a_0 = \pm \frac{1}{2}$. Now if $\beta$ is any root
        of $\chi(z)$, then the conjugate $\overline{\beta} = 2^{-2m}
        \beta^{-1}$ is also a root of $\chi(z)$.  Consider the polynomial $p(z)
        = z^m \chi\pfrac{2^{-2m}}{z}$. Then, $p(z)$ has the same roots and same
        degree as $\chi(z)$, so $\chi(z)$ is a constant multiple of $p(z)$.
        Computing the leading coefficient shows $a_0 \chi(z) = p(z)$, and
        equating the remaining coefficients gives for all $k \le m$,
        \[
            a_0 a_{m-k} = a_k 2^{-\frac{2k}{m}}.
        \]
        Thus $2^{-\frac{2k}{m}}$ is rational when $a_k \ne 0$. Let $\ell$
        be the smallest integer such that $2^{-\frac{2\ell}{m}}$ is rational:
        \[
            \ell = \begin{cases}
                m & \text{if $m$ is odd,}\\
                \frac{m}{2} & \text{if $m$ is even.}
            \end{cases}
        \]
        Then $a_k$ is nonzero only if $\ell \mid k$, so there exists a
        degree $\frac{m}{\ell}$ polynomial $P(z)$ such that
        $\chi(z) = P\paren{z^{\ell}}$. That is, the roots of $\chi(z)$ are
        of the form $\sqrt[\ell]{\beta}$ for $\beta$ a root of $P$.
        Note that $P(z)$ is monic and irreducible, has constant term $\pm
        \frac{1}{2}$, and all of its roots have norm $2^{-\frac{\ell}{m}}$.

        This process reduces $\chi(z)$ to a degree 1 or 2 polynomial, depending
        on the parity of $m$. If $m$ is odd, then the only possible polynomials
        are $P(z) = z \pm \frac{1}{2}$, both of which have a single rational
        root.  Thus the only interesting case is if $m$ is even, where we claim
        there are only 4 possibilities for $P(z)$. The appendix of
        \cite{Okano-Thesis} lists the $6$ polynomials over $\Q$ of degree 2
        which are monic, irreducible, and have constant term $\pm \frac{1}{2}$:
        \begin{align*}
            P_1(z) &= z^2 - \frac{1}{2}, &
            P_2(z) &= z^2 + \frac{1}{2},\\
            P_3(z) &= z^2 - z + \frac{1}{2}, &
            P_4(z) &= z^2 + z + \frac{1}{2},\\
            P_5(z) &= z^2 - \frac{1}{2} z + \frac{1}{2}, &
            P_6(z) &= z^2 + \frac{1}{2} z + \frac{1}{2}.
        \end{align*}
        We claim that, in orbit-rational case, $P(z)$ cannot be $P_5(z)$ or
        $P_6(z)$.  The polynomial $P_5(z)P_6(z)$ has roots $\beta = \pm
        \frac{i}{4} (\sqrt{7} \pm i)$, which live in the degree 2 extension
        $\Q(\sqrt{-7})$. If one of these roots satisfied $\beta^k = r$ for some
        integer $k$ and rational number $r$, then $\Q(\sqrt{-7})$ would contain
        an $k$th root of unity. Recall that a $k$th root of unity has degree
        $\varphi(k)$ over $\Q$, where $\varphi$ is Euler's totient function.
        Thus we would have $\varphi(k) = 2$, so $k = 3$ or $k = 4$. It's
        straightforward to check that $\beta^k$ is not rational for any of the
        above roots $\beta$ where $k = 3,4$.  Thus, $P_5(z)$ and $P_6(z)$ are
        not possible. One can also verify any root $\beta$ of $P_1(z)$,
        $P_2(z)$, $P_3(z)$, or $P_4(z)$ satisfies $\beta^4 = \pm \frac{1}{4}$.
        Thus, since the roots of $\chi(z)$ satisfy $\lambda^\ell = \beta$ for a
        root $\beta$ of $P(z)$, it follows that $\lambda^{4\ell}$ is rational.
    \end{proof}
\end{lemma}

\begin{thm}\label{thm:orbit_algorithm}
    Given an abelian binary invertible transducer $\A$, we can decide if
    $\gp(\A)$ is orbit-rational in polynomial time.
    \begin{proof}
        By \cref{thm:field_representation_efficient}, we can compute the
        number field representation of $\A$ to find $\chi(z)$ in time $O(n^6)$.
        Let $\ell$ be as in \cref{lemma:charpoly_restriction}. Using standard
        number field arithmetic techniques, we compute $z^{4 \ell}$ in the
        field $\Q[z] / (\chi(z))$ and check if it is rational, which by
        \cref{lemma:charpoly_restriction} is equivalent to $\gp(\A)$ being
        orbit rational.
    \end{proof}
\end{thm}

\pagebreak
\section{Discussion and Open Problems}

We introduced several classes of abelian transducers. The simplest nontrivial
automata are the CCC transducers, which have are SCC transducers with
one toggle state. We showed that the study of SCC transducers excludes only
groups generated by principal automata. The largest open problem in this area
is to prove the skew-symmetry conjecture: that every principal automaton
except for the sausage automata is skew-symmetric and self-inverse.

We also studied representations of abelian automaton groups, and extended the
results of Nekrashevych and Sidki in \cite{nekrashevych2004automorphisms}.
This yielded a representation as fractional ideals of an algebraic number field
$F(\A)$ where residuation in $\A$ corresponds to an affine map in $F(\A)$. This
representation removes redundancies present in the parameterization of matrix
representations, giving each automorphism in an abelian automaton group a
unique element in a number field. Additionally, we have demonstrated that this
representation is computable in polynomial time.

In \cref{sec:ideal-rep-classification}, we conjectured that $F(\A)$ is always
monogenic, which would have consequences for unique factorization of abelian
automaton groups. Proving this precondition remains an open problem.

Phrasing computational problems about $\A$ in terms of $F(\A)$ may yield
efficient solutions. We demonstrated this with the question of deciding
orbit-rationality, where the problem reduces to a simple computation in
$F(\A)$. We expect many other computational problems in $\A$ can exploit the
algebraic structure of $F(\A)$ in a similar way to yield efficient solutions.

It is not clear how these results may be generalized to non-abelian automaton
groups, and this is the largest open question we raise. At this time we are
not aware of any nonabelian orbit-rational automaton groups.

The algorithms discussed in this thesis were implemented in Sage. Field
representations for abelian automata of size under 40 may be computed in only a
few seconds, and hence orbit-rationality may be checked for a large class of
automata. Our code is available at
\[
    \codeurl.
\]

\printbibliography

\end{document}
